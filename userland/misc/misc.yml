- block:
    - block:
        - name: update system
          command: dnf update -y -q
          args:
            warn: false
          tags:
            - package

        - name: install packages
          dnf:
            enablerepo: google-chrome
            update_cache: yes
            state: present
            name:
              - google-chrome-stable
          tags:
            - package

        - name: configure misc sudo system stuffs
          shell: "{{item}}"
          with_items:
            - usermod -a -G dialout "{{ ansible_user_id }}"
            - usermod -a -G mock "{{ ansible_user_id }}"
            - timedatectl set-local-rtc 1 --adjust-system-clock

        - name: set inotify limit
          lineinfile:
            path: /etc/sysctl.conf
            line: "fs.inotify.max_user_watches=524288"

        - name: configure geo clue
          blockinfile:
            path: /etc/geoclue/geoclue.conf
            marker: "# {mark} redshift geoclue permission"
            block: |
              [redshift]
              allowed=true
              system=false
              users=
          tags:
            - geoclue
      become: true

    - name: set timezone to America/Los_Angeles
      timezone:
        name: America/Los_Angeles
      tags:
        - timezone

    - name: git
      command: "{{item}}"
      with_items:
        - git config --global credential.helper /usr/libexec/git-core/git-credential-libsecret
        - git config --global user.name "khoitd1997"
        - git config --global user.email "khoidinhtrinh@gmail.com"
        - git config --global core.autocrlf input
        - git config --global core.editor "vim"
        - git config --global merge.tool meld
      tags:
        - git
        - development

    - name: configure synapse
      command: "{{item}}"
      with_items:
        - mkdir -vp ~/.config/synapse/
        - ln -sfv {{ playbook_dir }}/misc/synapse_config.json ~/.config/synapse/config.json
      args:
        warn: false
      tags:
        - synapse

    - block:
        - name: copy nemo action files
          copy:
            src: "{{ item }}"
            dest: "~/.local/share/nemo/actions"
            owner: "{{ ansible_user_id }}"
            mode: 0644
          with_fileglob:
            - "{{ playbook_dir }}/misc/nemo/*.nemo_action"

        - name: configuring nemo bookmarks
          lineinfile:
            path: ~/.config/gtk-3.0/bookmarks
            line: "file:///home/{{ ansible_user_id }}/Dropbox/Class/"
      tags:
        - nemo

    - name: configure mint default app handler
      command: "{{item}}"
      with_items:
        - ln -sfv {{ playbook_dir }}/misc/mimeapps.list ~/.config/mimeapps.list
      args:
        warn: false
      tags:
        - handler

    - name: configure xdg open default app handler
      command: xdg-mime default {{ item.app }}.desktop {{ item.type }}
      with_items:
        - { type: application/pdf, app: evince.desktop }
        - { type: text/html, app: google-chrome.desktop }
        - { type: x-scheme-handler/http, app: google-chrome.desktop }
        - { type: x-scheme-handler/https, app: google-chrome.desktop }
        - { type: x-scheme-handler/about, app: google-chrome.desktop }
        - { type: x-scheme-handler/unknown, app: google-chrome.desktop }
        - { type: application/nemo-action, app: code.desktop }
        - { type: text/x-svsrc, app: code.desktop }
        - { type: text/x-go, app: code.desktop }
        - { type: application/x-java-keystore, app: code.desktop }
        - { type: text/x-c++src, app: code.desktop }
        - { type: text/x-c++hdr, app: code.desktop }
        - { type: text/x-chdr, app: code.desktop }
        - { type: text/x-csrc, app: code.desktop }
        - { type: application/x-shellscript, app: code.desktop }
        - { type: text/markdown, app: code.desktop }
        - { type: application/json, app: code.desktop }
        - { type: text/plain, app: code.desktop }
        - { type: evince.desktop, app: application/pdf }
        - { type: application/nemo-action, app: code.desktop }
        - { type: text/x-svsrc, app: code.desktop }
        - { type: text/x-go, app: code.desktop }
        - { type: application/x-java-keystore, app: code.desktop }
        - { type: text/x-c++src, app: code.desktop }
        - { type: text/x-c++hdr, app: code.desktop }
        - { type: text/x-chdr, app: code.desktop }
        - { type: text/x-csrc, app: code.desktop }
        - { type: application/x-shellscript, app: code.desktop }
        - { type: text/markdown, app: code.desktop }
        - { type: application/json, app: code.desktop }
        - { type: text/plain, app: code.desktop }
        - { type: inode/directory, app: nemo.desktop }

      args:
        warn: false
      tags:
        - xdg
        - handler

    - block:
        - name: configuring vim
          command: "{{item}}"
          with_items:
            - ln -vfs {{ playbook_dir }}/misc/vim/.vimrc ~/.vimrc
          args:
            warn: false
        - name: installing vim plugins
          shell: vim +'PlugInstall --sync' +qall &> /dev/null < /dev/tty
      tags:
        - vim
        - development

    - name: rofi
      command: "{{item}}"
      with_items:
        - mkdir -p ~/.config/rofi
        - ln -sfv {{ playbook_dir }}/misc/rofi/rofi_config ~/.config/rofi/rofi_config
        - ln -sfv {{ playbook_dir }}/misc/rofi/rofi_web_search.sh ~/.config/rofi/rofi_web_search.sh
        - ln -sfv {{ playbook_dir }}/misc/rofi/rofi_file_open.sh ~/.config/rofi/rofi_file_open.sh
      args:
        warn: false
      tags:
        - rofi
        - development

    - name: tmux
      command: "{{item}}"
      with_items:
        - ln -sfv {{ playbook_dir }}/misc/tmux/.tmux.conf ~/.tmux.conf
      args:
        warn: false
      tags:
        - tmux
        - development

    - block:
        - name: launch xpad
          shell: xpad 2>&1 &

        - name: configure xpad
          command: "{{item}}"
          with_items:
            - sleep 2
            - pkill xpad
            - rm -vf ~/.config/autostart/xpad.desktop

    - name: launcher apps
      command: "{{item}}"
      with_items:
        - mkdir -vp ~/.local/share/applications
        - mkdir -vp ~/.config/autostart
        - python3 "{{ playbook_dir }}"/misc/launcher_app/add_launcher_app.py
      args:
        warn: false
      tags:
        - launcher

    - name: other small misc stuffs
      command: "{{item}}"
      with_items:
        - mkdir -vp ~/temp
      args:
        warn: false

    - pip:
        name:
          - pylint
          - autopep8
        extra_args: --user
      tags:
        - pip

  tags:
    - misc
