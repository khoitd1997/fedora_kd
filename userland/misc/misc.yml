- block:
    - block:
        - include: package.yml
        - include: google-chrome/google-chrome.yml

        # convention is kd-{manufacture_name}
        - name: set host name
          shell: "{{item}}"
          with_items:
            - hostname kd-$(dmidecode -s baseboard-manufacturer | awk '{print $1;}')
            - hostnamectl set-hostname kd-$(dmidecode -s baseboard-manufacturer | awk '{print $1;}')
          tags:
            - hostname

        - name: configure misc sudo system stuffs
          shell: "{{item}}"
          with_items:
            - usermod -a -G dialout "{{ ansible_user_id }}"
            - usermod -a -G mock "{{ ansible_user_id }}"
            - timedatectl set-local-rtc 1 --adjust-system-clock

        - name: set inotify limit
          lineinfile:
            path: /etc/sysctl.conf
            line: "fs.inotify.max_user_watches=524288"

        - name: configure geo clue
          blockinfile:
            path: /etc/geoclue/geoclue.conf
            marker: "# {mark} redshift geoclue permission"
            block: |
              [redshift]
              allowed=true
              system=false
              users=
          tags:
            - geoclue

        - name: configure pam login
          blockinfile:
            path: /etc/pam.d/login
            marker: "# {mark} auto start pam"
            block: |
              session    optional     pam_gnome_keyring.so auto_start
              auth       optional     pam_gnome_keyring.so
          when: lookup('env', 'DESKTOP_SESSION') == "i3" or lookup('env', 'DESKTOP_SESSION') == "awesome"
          tags:
            - i3
            - awesome
            - keyring

        - include: npm/npm.yml

      become: true

    - include: helpful_script/helpful_script.yml

    - name: set timezone to America/Los_Angeles
      timezone:
        name: America/Los_Angeles
      tags:
        - timezone

    - include: git.yml

    - include: synapse/synapse.yml

    - include: nemo/nemo.yml

    - include: nautilus/nautilus.yml

    - include: launcher_app/launcher_app.yml

    - include: handler.yml

    - include: applet/applet.yml

    - include: rofi/rofi.yml

    - include: vim/vim.yml

    - include: tmux/tmux.yml

    - include: autokey/autokey.yml

    - name: configure .profile
      blockinfile:
        path: ~/.profile
        marker: "# {mark} .profile config"
        create: yes
        block: |
          eval $(gnome-keyring-daemon --start  --components=ssh,secrets)
          export SSH_AUTH_SOCK
      tags:
        - profile

    - block:
        - name: launch xpad
          shell: xpad 2>&1 &

        - name: configure xpad
          command: "{{item}}"
          with_items:
            - sleep 2
            - pkill xpad
            - rm -vf ~/.config/autostart/xpad.desktop

    # - include: xmodmap/xmodmap.yml

    - name: other small misc stuffs
      command: "{{item}}"
      with_items:
        - mkdir -vp ~/temp
      args:
        warn: false

    - pip:
        name:
          - pylint
          - autopep8
          - cpplint
          - cmake_format
        extra_args: --user
        executable: pip3
      tags:
        - pip
        - base

  tags:
    - misc
