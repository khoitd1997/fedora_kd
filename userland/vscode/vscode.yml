- block:
    - block:
        - name: add vscode keys
          command: "{{item}}"
          with_items:
            - rpm --import https://packages.microsoft.com/keys/microsoft.asc
            - sh -c 'echo -e "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" > /etc/yum.repos.d/vscode.repo'
          args:
            warn: false

        - name: install vscode package
          dnf:
            name: code
            state: latest
      become: true
      when: ansible_distribution == "Fedora"

    - block:
        - name: add vscode keys
          shell: "{{item}}"
          with_items:
            - curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
            - install -o root -g root -m 644 microsoft.gpg /etc/apt/trusted.gpg.d/
            - sh -c 'echo "deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main" > /etc/apt/sources.list.d/vscode.list'
          args:
            warn: false

        - name: install vscode package
          apt:
            name:
              - apt-transport-https
              - code
            update_cache: yes
      become: true
      when: ansible_distribution == "Ubuntu"

    - name: configure vscode
      command: sh "{{ playbook_dir }}/vscode/vscode_configure.sh"
      tags:
        - vscode_conf

    - name: install vscode extension
      command: sh "{{ playbook_dir }}/vscode/vscode_extension.sh"
      tags:
        - vscode_extension

  tags:
    - vscode
    - development
