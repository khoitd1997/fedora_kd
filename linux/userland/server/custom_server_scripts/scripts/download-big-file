#!/bin/bash

set -e

if [ "$#" -lt 1 ]; then
    echo "usage: download-big-file '<url>' '[file_name]'"
    exit 1
fi

work_dir=/bulk-storage/nfs/general/big_file_storage
log_dir=${work_dir}/logs
timestamp=$(date "+%Y_%m_%d-%H_%M_%S")
if [ -z "${2}" ]; then
    log_file=${log_dir}/download-big-file_${timestamp}.log
    wget_output_arg=""
else
    log_file=${log_dir}/download-big-file_${2}_${timestamp}.log
    wget_output_arg="--output-document ${2}"
fi

mkdir -p ${work_dir}
mkdir -p ${log_dir}
cd ${work_dir}


echo "Log file at ${log_file}"

nohup wget -q --show-progress --progress=dot:giga ${wget_output_arg} --content-disposition "${1}" > ${log_file} 2>&1 &
